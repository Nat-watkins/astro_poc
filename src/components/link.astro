---
import LaunchSvg from "#assets/uswds/img/usa-icons/launch.svg";
import type { RouteId } from "astro-typesafe-routes/path";
import type { RouteOptions } from "astro-typesafe-routes/path";
import { $path } from "astro-typesafe-routes/path";

type Props<T extends RouteId> = Omit<
  astroHTML.JSX.AnchorHTMLAttributes,
  "href"
> &
  RouteOptions<T> & {
    showIcon?: boolean;
  };

const {
  to,
  params,
  search,
  searchParams,
  hash,
  trailingSlash,
  showIcon = true,
  ...props
} = Astro.props;
const site = Astro.site;

const href = $path({ to, params, search, searchParams, hash, trailingSlash });
let isExternal = false;
try {
  const { hostname } = new URL(href || "");
  isExternal = hostname !== site?.hostname;
} catch {
  isExternal = false;
}
---

<a
  href={href}
  target={isExternal ? "_blank" : undefined}
  rel={isExternal ? "noopener" : undefined}
  {...props}
>
  <slot />{
    isExternal && showIcon ? (
      <LaunchSvg
        height={16}
        width={16}
        fill="currentColor"
        style="vertical-align:middle;"
        class="margin-left-2px"
      />
    ) : null
  }</a
>
